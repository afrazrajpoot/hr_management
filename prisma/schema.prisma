generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String      @id @default(uuid())
  firstName     String?
  lastName      String?
  phoneNumber   String?
  email         String?     @unique
  password      String?
  role          String?
  paid          Boolean     @default(false)
  amount        Float?      @default(0.0)
  quota         Float?      @default(0.0)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  emailVerified DateTime?
  image         String?
  position      String[]
  
  // FastAPI authentication
  fastApiToken      String?
  fastApiTokenExpiry DateTime?
  
  // Auth fields
  verificationToken String?
  resetToken       String?
  resetTokenExpiry DateTime?
  
  // Auto-login fields
  autoLoginToken   String?
  autoLoginExpiry  DateTime?

  department    String[]
  hrId          String?
  salary        String?
  accounts      Account[]
  sessions      Session[]
  employee      Employee?   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId    String?     @unique

  // Jobs posted by this user (Recruiter)
  jobs          Job[]       @relation("RecruiterJobs")

  // Applications submitted by this user (Candidate/Employee)
  applications  Application[]

  // Denormalized array of applied job IDs for employees
  appliedJobIds String[]

  orders        Order[]
  joinedCommunity Boolean @default(false)
  
  @@map("users")
}

// Optional: Store FastAPI sessions separately
model FastAPISession {
  id        String   @id @default(uuid())
  user_id   String
  email     String
  token     String
  expires_at DateTime
  created_at DateTime @default(now())
  
  @@unique([user_id])
}
model Department {
  id      String   @id @default(uuid())
  name    String

  hrId     String
userId      String
 ingoing   Json[]
  outgoing  Json[]
  promotion String?
  transfer  String?
  createdAt                         DateTime @default(now())
  updatedAt                         DateTime @updatedAt
}
model Account {
  id                 String   @id @default(uuid())
  userId             String
  user               User     @relation(fields: [userId], references: [id])
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  refresh_expires_at Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?
  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
  @@unique([identifier, token])
}

model Company {
  id           String   @id @default(uuid())
  companyDetail Json
  hrId          String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Employee {
  id            String         @id @default(uuid())
  employeeId    String         @unique
  firstName     String
  lastName      String
  address       String?
  nearbyArea    String?
  dateOfBirth   DateTime?
  hireDate      DateTime?
  manager       String?
  annualSalary  String?        // If you added this earlier
  employer      String?        // Add this new field
  bio           String?
  avatar        String?
  skills        Json?
  education     Json?
  experience    Json?
  resume        String?
  user          User?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model IndividualEmployeeReport {
  id                                Int      @id @default(autoincrement())
  createdAt                         DateTime @default(now())
  updatedAt                         DateTime @updatedAt
  userId                            String
  executiveSummary                  String
  hrId                              String?
  departement                       String?
  geniusFactorScore                 Int
  geniusFactorProfileJson            Json
  currentRoleAlignmentAnalysisJson   Json
  internalCareerOpportunitiesJson    Json
  retentionAndMobilityStrategiesJson Json
  developmentActionPlanJson          Json
  personalizedResourcesJson          Json
  dataSourcesAndMethodologyJson      Json
   risk_analysis                     Json
}

model Job {
  id             String      @id @default(uuid())
  title          String
  description    String
  location       String?
  salary         Int?
  type           JobType     @default(FULL_TIME)
  status         JobStatus   @default(OPEN)
  skills         Json?       // Optional JSON field for skills array (e.g., ["skill1", "skill2"] or null)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  // Relation to Recruiter (User)
  recruiter      User        @relation("RecruiterJobs", fields: [recruiterId], references: [id])
  recruiterId    String

  // Applications for this job
  applications   Application[]
  
}
model Application {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relation to User (Applicant)
  user        User     @relation(fields: [userId], references: [id])
  userId      String

  // Relation to Job
  job         Job      @relation(fields: [jobId], references: [id])
  jobId       String
  hrId        String?
  aiRecommendation  String?
  scoreMatch  String?
}
model AiCareerRecommendation {
  id             String      @id @default(uuid())
  employeeId   String
  careerRecommendation  String
}

model Notification{
    id             String      @id @default(uuid())
    message        String
    hrId           String
    employeeName   String
    employeeEmail  String
    employeeId     String
    status         String
   createdAt                         DateTime @default(now())
  updatedAt                         DateTime @updatedAt
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum JobStatus {
  OPEN
  CLOSED
  DRAFT
}

enum UserRole {
  CANDIDATE
  RECRUITER
  ADMIN
}


model ChatConversation {
  id           String   @id @default(cuid())
  hr_id        String
  department   String
  messages     Json     // Store entire conversation as JSON array
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([hr_id, department])
  @@map("chat_conversations")
}

model AnalysisResult {
  id              Int      @id @default(autoincrement())
  hrid            String   @db.VarChar(50)
  department_name String   @db.VarChar(255)
  ai_response     Json
  risk_score      Float?
  created_at      DateTime @default(now())

  @@index([hrid])
  @@index([department_name])
  @@index([created_at])
}


model EmployeeChat {
  id        String   @id @default(uuid())
  userId    String
  message   String
  response  String?
  createdAt DateTime @default(now())
}

model SubscriptionAttempt {
  id              String   @id @default(uuid())
  userId          String
  planName        String
  price           String
  status          String   @default("PENDING")
  samcartOrderId  String?
  checkoutUrl     String?
  metadata        Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("subscription_attempts")
}

model Order {
  id              String   @id @default(uuid())
  samcartOrderId  String   @unique
  customerEmail   String
  total           Float
  status          String
  planName        String?
  transactionId   String?
  processor       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User?    @relation(fields: [userId], references: [id])
  userId          String?

  @@map("orders")
}

